[
    {
        "Region": {
            "title": "Twig | Список объектов",
            "alias": "twig_realty_index",
            "block_count": 1
        },
        "Block": [
            {
                "title": "Twig | Список объектов",
                "alias": "twig_realty_index",
                "body": "{{ _view.assign('title', adSeo.titleList()) }}\r\n<section class=\"section-choice-case\" id=\"choice-case\">\r\n    <div class=\"container\">\r\n        <div class=\"add-case-block\">\r\n            <div class=\"title-normal title-min-size\"><h2>Выберите вариант<\/h2><\/div>\r\n            {{ form.create('Advertisement', {'url': {'plugin' : 'agency','controller' : 'realty', 'action' : 'index'}}) }}\r\n                <div class=\"choice-option-case\">\r\n                    <div class=\"choice-label-wrap\">\r\n                        {{ form.radio('rent', {'sale': 'Продажа','rent': 'Аренда'}, {\r\n                            'legend': false,\r\n                            'label': {'class': 'choice-label choice-label-big'},\r\n                            'hiddenField': false,\r\n                            'separator': '<\/div><div class=\"or\">или<\/div><div class=\"choice-label-wrap\">',\r\n                        }) }}\r\n                    <\/div>\r\n                <\/div>\r\n                <div class=\"show-map-block show-map-choice-case\"><div class=\"show-map-title\">Карта<\/div><div class=\"show-map-btn\"><\/div><\/div>\r\n                <div class=\"choice-case-title\">Вид недвижимости<\/div>\r\n                <ul class=\"choice-type-case-list not-marked nav\">\r\n                    <li>\r\n                        {{ form.radio('category_id', categories, {\r\n                            'legend': false,\r\n                            'label': {'class': 'choice-label choice-label-min'},\r\n                            'hiddenField': false,\r\n                            'separator': '<\/li><li>',\r\n                        }) }}\r\n                    <\/li>\r\n                <\/ul>\r\n                <div class=\"hidden-params\" style=\"display: none\">\r\n                    <div class=\"row select-block\">\r\n                        {{ searchView.renderField('Advertisement.district_id', attribute(searchFields, 'Advertisement.district_id')|merge({'div': 'col-1-4 col-xs-1-2', 'multiple': false, 'empty': true, 'data-allow-clear': \"true\"}) ) }}\r\n                        {{ searchView.renderField('Advertisement.locality_id', attribute(searchFields, 'Advertisement.locality_id')|merge({'div': 'col-1-4 col-xs-1-2', 'multiple': false, 'empty': true, 'data-allow-clear': \"true\"}) ) }}\r\n                        {{ searchView.renderField('Advertisement.sub_locality_id', attribute(searchFields, 'Advertisement.sub_locality_id')|merge({'div': 'col-1-4 col-xs-1-2', 'multiple': false, 'empty': true, 'data-allow-clear': \"true\"}) ) }}\r\n                        {{ searchView.renderField('Advertisement.street_id', attribute(searchFields, 'Advertisement.street_id')|merge({'div': 'col-1-4 col-xs-1-2', 'multiple': false, 'empty': true, 'data-allow-clear': \"true\"}) ) }}\r\n                    <\/div>\r\n                    {% set complexCategorySearch = _view.loadHelper('ComplexCategories.ComplexCategorySearch') %}\r\n\r\n                    {% set slidersFields = {} %}\r\n                    {% set selectFields = {} %}\r\n                    {% set checkboxFields = {} %}\r\n                    {% set textFields = {} %}\r\n\r\n                    {% for searchFieldAlias, searchFieldItem in searchFields %}\r\n                        {% if searchFieldAlias not in ['Advertisement.category_id', 'Advertisement.country_id', 'Advertisement.location_region_id', 'Advertisement.district_id', 'Advertisement.locality_id', 'Advertisement.sub_locality_id', 'Advertisement.micro_district_id', 'Advertisement.street_id', 'Advertisement.metro_id', 'Advertisement.house', 'Advertisement.rent','Advertisement.term_rent_id','Advertisement.id','Advertisement.show_in_hot','Advertisement.exclusive','Advertisement.polygon','Advertisement.currency_id','Advertisement.search','Advertisement.reservation'] %}\r\n                            {% if attribute(searchFieldItem, 'param-type') == -1 %}\r\n                                {% set checkboxFields = checkboxFields|merge({(searchFieldAlias): searchFieldItem}) %}\r\n                            {% endif %}\r\n                            {% if attribute(searchFieldItem, 'param-type') == 0 %}\r\n                                {% set slidersFields = slidersFields|merge({(searchFieldAlias): searchFieldItem}) %}\r\n                            {% endif %}\r\n                            {% if attribute(searchFieldItem, 'param-type') == 1 %}\r\n                                {% set textFields = textFields|merge({(searchFieldAlias): searchFieldItem}) %}\r\n                            {% endif %}\r\n                            {% if attribute(searchFieldItem, 'param-type') == 2 %}\r\n                                {% set selectFields = selectFields|merge({(searchFieldAlias): searchFieldItem})  %}\r\n                            {% endif %}\r\n                        {% endif %}\r\n                    {% endfor %}\r\n                    {% for slidersBatch in slidersFields|batch(2) %}\r\n                        <div class=\"row range-price-space-block\">\r\n                            {% for alias,field in slidersBatch %}\r\n                                {% set alias = alias|replace({'Advertisement.': ''}) %}\r\n                                <div class=\"col-1-2 col-xs-1 {{ complexCategorySearch.getClassesFilter(null, field)|join(' ')|replace({'input ': ''}) }}\">\r\n                                    <div class=\"choice-case-title\">{{ field.label }}<\/div>\r\n                                    <div class=\"case-range case-range-{{ alias }}\">\r\n                                        {{ form.hidden('Advertisement.' ~ alias ~ '_from', {'class': 'filter-from'} )}}\r\n                                        {{ form.hidden('Advertisement.' ~ alias ~ '_to', {'class': 'filter-to'} )}}\r\n                                        <div class=\"case-range-{{ alias }}-min\"><\/div>\r\n                                        <div class=\"case-range-{{ alias }}-max\"><\/div>\r\n                                    <\/div>\r\n                                    <div class=\"params-slider slider-range\" data-field=\"{{ alias }}\" data-min=\"{{ attribute(searchView.getRange({'alias': alias}), 'min') }}\" data-max=\"{{ attribute(searchView.getRange({'alias': alias}), 'max') }}\" data-step=\"{{ attribute(searchView.getRange({'alias': alias}), 'step') }}\"><\/div>\r\n                                <\/div>\r\n                            {% endfor %}\r\n                        <\/div>\r\n                    {% endfor %}\r\n                    {% for selectBatch in selectFields|batch(4) %}\r\n                        <div class=\"row select-block\">\r\n                            {% for alias,field in selectBatch %}\r\n                                <div class=\"col-1-4 col-xs-1-2 {{ complexCategorySearch.getClassesFilter(null, field)|join(' ')|replace({'input ': ''}) }}\">\r\n                                    {{ form.input(alias, {\r\n                                        'div': false,\r\n                                        'type': 'select',\r\n                                        'label': false,\r\n                                        'empty': true,\r\n                                        'data-placeholder': field.label,\r\n                                        'data-allow-clear': \"true\",\r\n                                        'options': _view.get(attribute(field, 'data-options')),\r\n                                    }) }}\r\n                                <\/div>\r\n                            {% endfor %}\r\n                        <\/div>\r\n                    {% endfor %}\r\n                    {% for textBatch in textFields|batch(4) %}\r\n                        <div class=\"row\">\r\n                            {% for alias,field in textBatch %}\r\n                                <div class=\"col-1-4 col-xs-1-2 {{ complexCategorySearch.getClassesFilter(null, field)|join(' ')|replace({'input ': ''}) }}\">\r\n                                    {{ form.input(alias, {\r\n                                        'div': false,\r\n                                        'label': false,\r\n                                        'type': 'text',\r\n                                        'placeholder': field.label,\r\n                                    }) }}\r\n                                <\/div>\r\n                            {% endfor %}\r\n                        <\/div>\r\n                    {% endfor %}\r\n                    <div class=\"row\">\r\n                        <div class=\"col-1-4 col-xs-1-2\">\r\n                            <ul class=\"check-list-case not-marked\">\r\n                                {% for alias,checkbox in checkboxFields %}\r\n                                    <li class=\"{{ complexCategorySearch.getClassesFilter(null, checkbox)|join(' ')|replace({'input ': ''}) }}\">\r\n                                        <label>\r\n                                            {{ form.checkbox('Advertisement.' ~ attribute(checkbox, 'param-id'), {\r\n                                                'hidden': true,\r\n                                                'div': false,\r\n                                                'label': false,\r\n                                                'hiddenField': false,\r\n                                            }) }} {{ checkbox.label }}\r\n                                        <\/label>\r\n                                    <\/li>\r\n                                {% endfor %}\r\n                            <\/ul>\r\n                        <\/div>\r\n                    <\/div>\r\n                <\/div>\r\n                <div class=\"row filter-control-block\">\r\n                    <div class=\"col-1-6 col-xs-1\">\r\n                        <button type=\"reset\" class=\"filter-default\">\r\n                            Сбросить фильтр <svg width=\"34\" height=\"34\" class=\"svg-icon cross-icon\" xmlns=\"http:\/\/www.w3.org\/2000\/svg\" x=\"0px\" y=\"0px\" viewBox=\"0 0 64 64\">\r\n                                <path class=\"st0\" d=\"M28.9,31.8L0.6,60.1c-0.8,0.8-0.8,2.1,0,2.8C1,63.4,1.5,63.6,2,63.6s1-0.2,1.4-0.6L32,34.4L60.5,63 c0.4,0.4,0.9,0.6,1.4,0.6s1-0.2,1.4-0.6c0.8-0.8,0.8-2.1,0-2.8L35.1,31.8L63.4,3.4c0.8-0.8,0.8-2.1,0-2.8c-0.8-0.8-2.1-0.8-2.8,0 L32,29.1L3.4,0.6c-0.8-0.8-2.1-0.8-2.8,0c-0.8,0.8-0.8,2.1,0,2.8L28.9,31.8z\" fill=\"#fff\"\/>\r\n                            <\/svg>\r\n                        <\/button>\r\n                    <\/div>\r\n                    <div class=\"col-1-3 col-xs-1 align-center align-left-mobile\">\r\n                        <button type=\"button\" class=\"filter-option-hide hide\"><span>показать часть параметров<\/span><div class=\"icon\"><\/div><\/button>\r\n                    <\/div>\r\n                    <div class=\"col-1-4 col-xs-1\">\r\n                        <div class=\"filter-num-result\">Найдено <b>{{ paginator.params.current }}<\/b> вариантов<\/div>\r\n                    <\/div>\r\n                    <div class=\"col-1-4 col-xs-1\">\r\n                        <button type=\"submit\" class=\"filter-default\">Найти<\/button>\r\n                    <\/div>\r\n                <\/div>\r\n            {{ form.end() }}\r\n            <div class=\"choice-case-map hide\">\r\n                {{ html.script(['https:\/\/api-maps.yandex.ru\/2.1\/?lang=ru_RU', 'Agency.filter-map-site', 'YandexMaps.simplify'], {'inline': false}) }}\r\n                <div class=\"map-choice-wrap\" id=\"map-list\"><\/div>\r\n                {{ html.scriptStart({'inline': false, 'safe': false}) }}\r\n                let KlasterIs2bMapSite = {\r\n                    url: null,\r\n                    init: function (YandexMapCenter, url) {\r\n                        this.url = url;\r\n                        Is2bMap.init('map-list', YandexMapCenter, [], {'isAdmin': false});\r\n                        let d = '';\r\n                        this.loadObjects(d, true);\r\n\r\n                        Is2bMap.map.events.add('boundschange', function (e) {\r\n                            if (Is2bMap.block.hasClass('is2b-loaded-points')) {\r\n                                return !1;\r\n                            }\r\n                            d = Is2bMap.dataMapKlaster();\r\n                            KlasterIs2bMapSite.loadObjects(d, false);\r\n                        });\r\n                    },\r\n                    setBounds: function () {\r\n                        if (Is2bMap.geoObjects != null) {\r\n                            if (Is2bMap.geoObjects.length > 0) {\r\n                                console.log('set Bounsds');\r\n                                console.log(Is2bMap.clusterer.getBounds());\r\n                                Is2bMap.map.setBounds(Is2bMap.clusterer.getBounds(), {\r\n                                    checkZoomRange: true\r\n                                });\r\n                            }\r\n                        }\r\n                    },\r\n                    loadObjects: function (d, setBounds) {\r\n                        Is2bMap.removeAllPoints();\r\n                        $.ajax({\r\n                            url: this.url + (d === '' ? '' : '&' + d),\r\n                            dataType: 'json'\r\n                        }).done(function (data) {\r\n                            console.log(data.length);\r\n                            Is2bMap.setPoints(data);\r\n                            if (setBounds) {\r\n                                KlasterIs2bMapSite.setBounds();\r\n                            }\r\n                        });\r\n                    }\r\n                };\r\n                ymaps.ready(function () {\r\n                    KlasterIs2bMapSite.init({{ yaMaps.YandexMapCenter() }}, window.location.protocol + '\/\/' + window.location.hostname + '\/agency\/realty\/map' + (window.location.search || '?1=1'));\r\n                })\r\n                {{ html.scriptEnd() }}\r\n            <\/div>\r\n            <div class=\"result-items-case\">\r\n                <div class=\"row row-3 case-items-block\">\r\n                    {{ adView.setDefaults({default_picture: config.Site.no_photo_image}) }}\r\n                    {% for item in list %}\r\n                        {% set offerItem = adView.getInfo(item) %}\r\n                        <div class=\"col-1-3 col-xs-1\">\r\n                            <a href=\"{{ html.url(offerItem.url) }}\" class=\"case-item\" title=\"{{ adSeo.pattern_title(item)|e }}\">\r\n                                {% set favoriteActiveClass = '' %}\r\n                                {% set favoriteAction = 'add' %}\r\n                                {% if favorite.has('Advertisement', item.Advertisement.id) %}\r\n                                    {% set favoriteActiveClass = ' active' %}\r\n                                    {% set favoriteAction = 'remove' %}\r\n                                {% endif %}\r\n                                {{ html.tag('div', '', {\r\n                                    'class': 'favorites-action star' ~ favoriteActiveClass,\r\n                                    'escape': false,\r\n                                    'data-model': 'Advertisement',\r\n                                    'data-id': item.Advertisement.id,\r\n                                    'data-action': favoriteAction\r\n                                }) }}\r\n                                <div class=\"case-id\">id {{ item.Advertisement.id }}<\/div>\r\n                                <picture class=\"case-image-wrap\">\r\n                                    {% set gallery = adView.getGallery(item) %}\r\n                                    {% set galleryFirstItem = imageResized.resizeItemPicture(gallery.first, {'width': '379', 'height': '266', 'mode': 'fit', 'paddings': false, 'folder': 'twig_fit_realty_list'}) %}\r\n                                    <img src=\"{{ galleryFirstItem.src }}\" class=\"case-image\" alt=\"{{ galleryFirstItem.description }}\">\r\n                                <\/picture>\r\n                                <div class=\"case-content\">\r\n                                    <div class=\"case-title\">{{ item.Advertisement.location_full|e }}<\/div>\r\n                                    <div class=\"case-price\">{{ price.format(item.Advertisement.price) }} ₽<\/div>\r\n                                    <div class=\"case-text\">{{ adView.getSiteText(item)|striptags|slice(0, 50) }}...<\/div>\r\n                                <\/div>\r\n                            <\/a>\r\n                        <\/div>\r\n                    {% endfor %}\r\n                <\/div>\r\n            <\/div>\r\n        <\/div>\r\n    <\/div>\r\n<\/section>\r\n",
                "status": true,
                "params": "disabledCkEditor=1",
                "show_title": false,
                "visibility_roles": "",
                "visibility_paths": ""
            }
        ]
    }
]