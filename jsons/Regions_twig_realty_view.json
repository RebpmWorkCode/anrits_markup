[
    {
        "Region": {
            "title": "Twig | Просмотр объекта",
            "alias": "twig_realty_view",
            "block_count": 1
        },
        "Block": [
            {
                "title": "Twig | Просмотр объекта",
                "alias": "twig_realty_view",
                "body": "{{ html.script(['https:\/\/api-maps.yandex.ru\/2.1\/?lang=ru_RU', 'Agency.filter-map-site.js', 'YandexMaps.view-map.js'], {'inline': false}) }}\r\n{% set adView = _view.loadHelper('Agency.AdView') %}\r\n{% set adSeo = _view.loadHelper('Agency.AdSeo') %}\r\n{% set favorite = _view.loadHelper('Favorites.Favorite') %}\r\n{{ adView.setOgparh(advertisement) }}\r\n{{ adSeo.imageSrcLink(advertisement) }}\r\n{{ adView.setDefaults({default_picture: config.Site.no_photo_image}) }}\r\n<section class=\"section-case-card\" id=\"case-card\">\r\n    <div class=\"container\">\r\n        <ul class=\"breadcrumbs not-marked nav\">\r\n            <li><a href=\"\/\" class=\"breadcrumbs-link\">\r\n                <svg class=\"svg-icon smart-home-icon\" xmlns=\"http:\/\/www.w3.org\/2000\/svg\" x=\"0px\" y=\"0px\" viewBox=\"0 0 223 193.5\">\r\n                    <path class=\"st0\" d=\"M204.5,79.3l-86-76.7c-4-3.5-9.9-3.5-13.9,0l-86,76.7c-2.2,2-3.5,4.8-3.5,7.8v96c0,5.8,4.7,10.4,10.4,10.4 h172.1c5.8,0,10.4-4.7,10.4-10.4v-96C208,84.1,206.7,81.3,204.5,79.3L204.5,79.3z M187.1,172.6H35.9V91.8l75.6-67.4l75.6,67.4 V172.6L187.1,172.6z\"\/>\r\n                <\/svg>\r\n            <\/a><\/li>\r\n            <li><a href=\"#\" class=\"breadcrumbs-link dark\">Недвижимость<\/a><\/li>\r\n            <li><a href=\"#\" class=\"breadcrumbs-link dark\">{{ adSeo.pattern_title(advertisement)|e }}<\/a><\/li>\r\n        <\/ul>\r\n        <div class=\"title-normal title-min-size\"><h2>{{ adSeo.pattern_title(advertisement)|e }}<\/h2><\/div>\r\n        <div class=\"row\">\r\n            <div class=\"col-2-3 col-xs-1\">\r\n                {% set gallery = adView.getGallery(advertisement) %}\r\n                {% set galleryList = gallery.items ?: [gallery.first] %}\r\n                <div class=\"swiper-container case-slider-top\">\r\n                    <div class=\"swiper-wrapper\">\r\n                        {% for galleryItem in galleryList %}\r\n                            <div class=\"swiper-slide case-slide\">\r\n                                {% set favoriteActiveClass = '' %}\r\n                                {% set favoriteAction = 'add' %}\r\n                                {% if favorite.has('Advertisement', advertisement.Advertisement.id) %}\r\n                                    {% set favoriteActiveClass = ' active' %}\r\n                                    {% set favoriteAction = 'remove' %}\r\n                                {% endif %}\r\n                                {{ html.tag('div', '', {\r\n                                    'class': 'favorites-action star' ~ favoriteActiveClass,\r\n                                    'escape': false,\r\n                                    'data-model': 'Advertisement',\r\n                                    'data-id': advertisement.Advertisement.id,\r\n                                    'data-action': favoriteAction\r\n                                }) }}\r\n                                <img src=\"{{ galleryItem.src }}\" alt=\"{{ galleryItem.description }}\" class=\"case-slide-image-top\">\r\n                            <\/div>\r\n                        {% endfor %}\r\n                    <\/div>\r\n                <\/div>\r\n                <div class=\"case-slider-thumbs-wrap\">\r\n                    <div class=\"swiper-container case-slider-thumbs\">\r\n                        <div class=\"swiper-wrapper\">\r\n                            {% for galleryItem in galleryList %}\r\n                                <div class=\"swiper-slide\">\r\n                                    <img src=\"{{ galleryItem.src }}\" alt=\"{{ galleryItem.description }}\" class=\"case-slide-image-thumb\">\r\n                                <\/div>\r\n                            {% endfor %}\r\n                        <\/div>\r\n                    <\/div>\r\n                    <div class=\"swiper-button-next swiper-button-circle case-thumbs-next\">\r\n                        <svg class=\"svg-icon right-chevron\" xmlns=\"http:\/\/www.w3.org\/2000\/svg\" x=\"0px\" y=\"0px\" viewBox=\"0 0 185.3 185.3\">\r\n                            <path class=\"st0\" d=\"M51.7,185.3c-2.7,0-5.5-1-7.6-3.1c-4.2-4.2-4.2-11,0-15.2l74.4-74.3L44.1,18.3c-4.2-4.2-4.2-11,0-15.2 c4.2-4.2,11-4.2,15.2,0l81.9,81.9c4.2,4.2,4.2,11,0,15.2l-81.9,81.9C57.2,184.3,54.5,185.3,51.7,185.3z\"\/>\r\n                        <\/svg>\r\n                    <\/div>\r\n                    <div class=\"swiper-button-prev swiper-button-circle case-thumbs-prev\">\r\n                        <svg class=\"svg-icon left-chevron\" xmlns=\"http:\/\/www.w3.org\/2000\/svg\" x=\"0px\" y=\"0px\" viewBox=\"0 0 185.3 185.3\">\r\n                            <path class=\"st0\" d=\"M133.6,0c2.7,0,5.5,1,7.6,3.1c4.2,4.2,4.2,11,0,15.2L66.9,92.7l74.4,74.4c4.2,4.2,4.2,11,0,15.2 c-4.2,4.2-11,4.2-15.2,0l-81.9-81.9c-4.2-4.2-4.2-11,0-15.2L126,3.1C128.1,1,130.9,0,133.6,0z\"\/>\r\n                        <\/svg>\r\n                    <\/div>\r\n                <\/div>\r\n                <div class=\"case-text-info-block\">\r\n                    {{ location.setConfigFormEdit('Location.form_site_view') }}\r\n                    {% if location.hasShowField('Locality') %}\r\n                        <p><span class=\"left\">Населенный пункт<\/span><span class=\"right\">{{ advertisement.Location.Locality.title }}<\/span><\/p>\r\n                    {% endif %}\r\n                    {% if location.hasShowField('Street') %}\r\n                        <p><span class=\"left\">Улица<\/span><span class=\"right\">{{ advertisement.Location.Street.title }}<\/span><\/p>\r\n                    {% endif %}\r\n                    {% if location.hasShowField('HouseNumber') %}\r\n                        <p><span class=\"left\">Номер дома<\/span><span class=\"right\">{{ advertisement.Location.house_number }}<\/span><\/p>\r\n                    {% endif %}\r\n                <\/div>\r\n                {% if advertisement.Rieltor.id %}\r\n                    <div class=\"agent-block hidden-xs\">\r\n                        <div class=\"agent-image-wrap\">\r\n                            {% if advertisement.Rieltor.image %}\r\n                                <img src=\"{{ '\/'~advertisement.Rieltor.image|trim('\/', 'left') }}\" class=\"agent-image\" alt=\" \">\r\n                            {% endif %}\r\n                        <\/div>\r\n                        <div class=\"agent-info\">\r\n                            <div class=\"agent-name\">{{ advertisement.Rieltor.name }}<\/div>\r\n                            <a href=\"tel:{{ user.getPhoneLink(advertisement.Rieltor) }}\" class=\"agent-phone dark\">\r\n                                <span class=\"phone-icon-wrap\">\r\n                                    <svg class=\"svg-icon phone-icon\" xmlns=\"http:\/\/www.w3.org\/2000\/svg\" x=\"0px\" y=\"0px\" viewBox=\"0 0 459 459\" xml:space=\"preserve\">\r\n                                        <path class=\"st0\" d=\"M433.5,318.8c-30.6,0-61.2-5.1-91.8-15.3c-7.6-2.5-17.9,0-25.5,5.1l-56.1,56.1 c-71.4-35.7-130.1-96.9-168.3-168.3l56.1-56.1c7.6-7.6,10.2-17.8,5.1-25.5c-7.6-28.1-12.8-58.7-12.8-89.3 c0-15.3-10.2-25.5-25.5-25.5H25.5C10.2,0,0,10.2,0,25.5C0,265.2,193.8,459,433.5,459c15.3,0,25.5-10.2,25.5-25.5v-89.3 C459,329,448.8,318.8,433.5,318.8z\"\/>\r\n                                    <\/svg>\r\n                                <\/span> {{ user.getPhoneLink(advertisement.Rieltor) }}\r\n                            <\/a>\r\n                            <a href=\"mailto:{{ advertisement.Rieltor.email }}\" class=\"agent-email dark\">{{ advertisement.Rieltor.email }}<\/a>\r\n                            <a href=\"#\" class=\"btn btn-transparent btn-callback open-phone-modal\">Связаться с агентом<\/a>\r\n                        <\/div>\r\n                    <\/div>\r\n                {% endif %}\r\n            <\/div>\r\n            <div class=\"col-1-3 col-xs-1\">\r\n                <div class=\"case-price-info\">\r\n                    <div class=\"case-id\">id {{ advertisement.Advertisement.id }}<\/div>\r\n                    <div class=\"case-price-total\">Стоимость <b>{{ price.format(advertisement.Advertisement.price) }} ₽<\/b><\/div>\r\n                    <div class=\"case-price-space\">Цена кв.м. <b>{{ price.format(advertisement.Advertisement.price_area) }} ₽<\/b><\/div>\r\n                <\/div>\r\n                <div class=\"mortgage-calc-wrap\">\r\n                    <div class=\"mortgage-title\">Рассчитать ипотеку<\/div>\r\n                    <div class=\"mortgage-calc\" id=\"mortgage-calc\">\r\n                        <label for=\"case-price-num\" class=\"label-title\">Стоимость объекта<\/label>\r\n                        <input step=\"5000\" min=\"0\" type=\"number\" id=\"case-price-num\" value=\"{{ advertisement.Advertisement.price }}\">\r\n                        <label for=\"credit-sum\" class=\"label-title\">Сумма кредита<\/label>\r\n                        <input step=\"5000\" min=\"0\" type=\"number\" id=\"credit-sum\" placeholder=\"Введите сумму\">\r\n                        <label for=\"credit-precent\" class=\"label-title\">Процентная ставка (%)<\/label>\r\n                        <input step=\"1\" min=\"0\" type=\"number\" id=\"credit-precent\" placeholder=\"Введите ставку в %\">\r\n                        <label for=\"credit-time\" class=\"label-title\">Срок кредита (лет)<\/label>\r\n                        <input step=\"1\" min=\"0\" type=\"number\" id=\"credit-time\" placeholder=\"Введите цифру\">\r\n                        <div class=\"mortgage-calc-result\">\r\n                            <div><span class=\"left\">Сумма переплаты:<\/span><span class=\"right\"><span id=\"overpaymentAmount\">0<\/span>₽<\/span><\/div>\r\n                            <div><span class=\"left\">Сумма общая:<\/span><span class=\"right\"><b><span id=\"totalAmount\">0<\/span>₽<\/b><\/span><\/div>\r\n                            <div><span class=\"left\">Ежемесячный платеж:<\/span><span class=\"right\"><span id=\"monthlyPayment\">0<\/span>₽<\/span><\/div>\r\n                        <\/div>\r\n                        <div class=\"btn-wrap align-center\"><a href=\"#\" class=\"btn btn-transparent btn-mortgage open-mortgage-modal\">Оставить заявку на ипотеку<\/a><\/div>\r\n                        {{ html.script({0: '\/theme\/Default\/js\/mortgage.js', 1: '\/agency\/js\/price_number_format.js'}, {'inline': false}) }}\r\n                        {{ html.scriptStart({'inline': false, 'safe': false}) }}\r\n                            $(document).ready(() => {\r\n                                const mortgageCalc = $('#mortgage-calc');\r\n                                let casePriceNum = mortgageCalc.find('#case-price-num'), \/\/стоимость объекта\r\n                                    creditSum = mortgageCalc.find('#credit-sum'), \/\/cумма кредита\r\n                                    creditPrecent = mortgageCalc.find('#credit-precent'), \/\/Процентная ставка\r\n                                    creditTime = mortgageCalc.find('#credit-time'), \/\/Срок кредита\r\n                                    overpaymentAmountSpan = mortgageCalc.find('#overpaymentAmount'),\r\n                                    totalAmountSpan = mortgageCalc.find('#totalAmount'),\r\n                                    monthlyPaymentSpan = mortgageCalc.find('#monthlyPayment');\r\n                                const updateMortgageOutput = () => {\r\n                                    const mortgage = new Mortgage(casePriceNum.val(), +creditPrecent.val(), +creditTime.val());\r\n                                    mortgage.setPercentageInitialPayment(((casePriceNum.val() - creditSum.val()) \/ casePriceNum.val()) * 100 );\r\n                                    const setOutput = (selector, value) => selector.text(formatNumber(value, 0));\r\n                                    setOutput(overpaymentAmountSpan, mortgage.overpayment())\r\n                                    setOutput(totalAmountSpan, mortgage.monthlyPayment() * mortgage.creditTerm * 12)\r\n                                    setOutput(monthlyPaymentSpan, mortgage.monthlyPayment())\r\n                                };\r\n                                casePriceNum.on('change', updateMortgageOutput);\r\n                                creditSum.on('change', updateMortgageOutput);\r\n                                creditPrecent.on('change', updateMortgageOutput);\r\n                                creditTime.on('change', updateMortgageOutput);\r\n                                $('.open-mortgage-modal').on('click', e => {\r\n                                    $('#form_case-price-num').val(casePriceNum.val());\r\n                                    $('#form_payment').val(casePriceNum.val() - creditSum.val());\r\n                                    $('#form_credit-precent').val(creditPrecent.val());\r\n                                    $('#form_credit-time').val(creditTime.val());\r\n                                })\r\n                            })\r\n                        {{ html.scriptEnd() }}\r\n                    <\/div>\r\n                <\/div>\r\n            <\/div>\r\n        <\/div>\r\n        <div class=\"tabs-block case-tabs-description\" data-tab-block=\"t-case-desc\">\r\n            <ul class=\"nav nav-tabs\">\r\n                <li class=\"tab-link active\" data-tab=\"t-case-desc-1\" data-tab-block=\"t-case-desc\">Описание<\/li>\r\n                <li class=\"tab-link\" data-tab=\"t-case-desc-2\" data-tab-block=\"t-case-desc\">Сведения о недвижимости<\/li>\r\n                <li class=\"tab-link\" data-tab=\"t-case-desc-3\" data-tab-block=\"t-case-desc\">Смотреть на карте<\/li>\r\n            <\/ul>\r\n            <div class=\"tabs-content-container\">\r\n                <div class=\"tab-content active\" data-tab=\"t-case-desc-1\" data-tab-block=\"t-case-desc\">\r\n                    <div class=\"case-tabs-description-content\">\r\n                        <div class=\"case-tabs-description-title\">Описание<\/div>\r\n                        <div class=\"case-tab-description-text\">{{ adView.getSiteText(advertisement) }}<\/div>\r\n                    <\/div>\r\n                <\/div>\r\n                <div class=\"tab-content\" data-tab=\"t-case-desc-2\" data-tab-block=\"t-case-desc\">\r\n                    <div class=\"case-tabs-description-content\">\r\n                        <div class=\"case-tabs-description-title\">Сведения о недвижимости<\/div>\r\n                        <table class=\"case-description-table\">\r\n                            {% set complexCategory = _view.loadHelper('ComplexCategories.ComplexCategory') %}\r\n                            {% set viewCategoryParams = complexCategory.getParamAliases(advertisement.CategoryParamValues, 'show_on_main', {}, 'weight') %}\r\n                            {% for values in viewCategoryParams %}\r\n                                {% if values.value %}\r\n                                    <tr>\r\n                                        <td>{{ values.name }}<\/td>\r\n                                        <td>{{ values.display_value|join(',') }}<\/td>\r\n                                    <\/tr>\r\n                                {% endif %}\r\n                            {% endfor %}\r\n                        <\/table>\r\n                    <\/div>\r\n                <\/div>\r\n                <div class=\"tab-content\" data-tab=\"t-case-desc-3\" data-tab-block=\"t-case-desc\">\r\n                    <div class=\"case-tabs-description-content\">\r\n                        <input type=\"hidden\" id=\"latitude\" value=\"{{ adView.getCoordinateSite(advertisement).latitude }}\"\/>\r\n                        <input type=\"hidden\" id=\"longitude\" value=\"{{ adView.getCoordinateSite(advertisement).longitude }}\"\/>\r\n                        <div class=\"map-contact-wrap\" id=\"map\"><\/div>\r\n                    <\/div>\r\n                <\/div>\r\n            <\/div>\r\n        <\/div>\r\n    <\/div>\r\n<\/section>\r\n\r\n{% if similarOffers %}\r\n<section class=\"section-offer\" id=\"offer\">\r\n    <div class=\"container\">\r\n        <div class=\"title-normal title-min-size\"><h2>Похожие предложения<\/h2><\/div>\r\n        <div class=\"row row-3\">\r\n            {% for item in similarOffers %}\r\n                {% set offerItem = adView.getInfo(item) %}\r\n                <div class=\"col-1-3 col-xs-1\">\r\n                    <a href=\"{{ html.url(offerItem.url) }}\" class=\"case-item\" title=\"{{ adSeo.pattern_title(item)|e }}\">\r\n                        {% set favoriteActiveClass = '' %}\r\n                        {% set favoriteAction = 'add' %}\r\n                        {% if favorite.has('Advertisement', item.Advertisement.id) %}\r\n                            {% set favoriteActiveClass = ' active' %}\r\n                            {% set favoriteAction = 'remove' %}\r\n                        {% endif %}\r\n                        {{ html.tag('div', '', {\r\n                            'class': 'favorites-action star' ~ favoriteActiveClass,\r\n                            'escape': false,\r\n                            'data-model': 'Advertisement',\r\n                            'data-id': item.Advertisement.id,\r\n                            'data-action': favoriteAction\r\n                        }) }}\r\n                        <div class=\"case-id\">id {{ item.Advertisement.id }}<\/div>\r\n                        <picture class=\"case-image-wrap\">\r\n                            {% set gallery = adView.getGallery(item) %}\r\n                            {% set galleryFirstItem = imageResized.resizeItemPicture(gallery.first, {'width': '379', 'height': '266', 'mode': 'fit', 'paddings': false, 'folder': 'twig_fit_realty_list'}) %}\r\n                            <img src=\"{{ galleryFirstItem.src }}\" class=\"case-image\" alt=\"{{ galleryFirstItem.description }}\">\r\n                        <\/picture>\r\n                        <div class=\"case-content\">\r\n                            <div class=\"case-title\">{{ item.Advertisement.location_full|e }}<\/div>\r\n                            <div class=\"case-price\">{{ price.format(item.Advertisement.price) }} ₽<\/div>\r\n                            <div class=\"case-text\">{{ adView.getSiteText(item)|striptags|slice(0, 50) }}...<\/div>\r\n                        <\/div>\r\n                    <\/a>\r\n                <\/div>\r\n            {% endfor %}\r\n        <\/div>\r\n    <\/div>\r\n<\/section>\r\n{% endif %}\r\n",
                "status": true,
                "params": "disabledCkEditor=1",
                "show_title": false,
                "visibility_roles": "",
                "visibility_paths": ""
            }
        ]
    }
]